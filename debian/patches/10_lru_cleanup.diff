diff --git a/ccache.c b/ccache.c
index c636692..39742d9 100644
--- a/ccache.c
+++ b/ccache.c
@@ -499,6 +499,9 @@ static void from_cache(int first)
 		return;
 	}
 
+	/* update timestamps for LRU cleanup
+	   also gives output_file a sensible mtime when hard-linking (for make) */
+	utime(hashname, NULL);
 	utime(stderr_file, NULL);
 
 	if (strcmp(output_file, "/dev/null") == 0) {
@@ -533,10 +536,6 @@ static void from_cache(int first)
 			failed();
 		}
 	}
-	if (ret == 0) {
-		/* update the mtime on the file so that make doesn't get confused */
-		utime(output_file, NULL);
-	}
 
 	/* get rid of the intermediate preprocessor file */
 	if (i_tmpfile) {
